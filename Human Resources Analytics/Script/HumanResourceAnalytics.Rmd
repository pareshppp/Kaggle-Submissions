---
title: "R Notebook"
output: 
    html_notebook:
        output: readable
        author: Paresh Pradhan
---
##Introduction

Find why the best and most experienced employees are leaving prematurely.

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
```


##Input and Preprocess

Reading data:
```{r}
hra.data <- read.csv('../Input/HR_comma_sep.csv', stringsAsFactors = F)
```

Modifying Data:
```{r}
hra.data <- tbl_df(hra.data)
hra.data$department <- hra.data$sales
hra.data$sales <- NULL
```

Adding Employee Status
```{r}
hra.data$emp.status <- ifelse(hra.data$left == 1, 'Left', 'Retained')
```

Converting to Factors
```{r}
hra.data[,c(-1, -2, -4)] <- lapply(hra.data[,c(-1, -2, -4)], factor)
```


##Exploration

```{r}
glimpse(hra.data)
```

```{r}
summary(hra.data)
```



<br><br><br><html>
###Employee Status

Distribution of Employees Retained vs Left

```{r}
g1 <- hra.data %>% 
    ggplot(mapping = aes(x = emp.status)) +
    geom_bar() +
    labs(x = 'Employee Status',
         y = 'Count',
         title = 'Retained vs Left')
g1
```

Almost a third of the employees have left the company compared to those retained.



<br><br><br><html>
###Satisfaction Level

Lets compare the satisfaction levels:

```{r}
g1.1 <- hra.data %>%
    ggplot(mapping = aes(x = satisfaction_level, fill = emp.status)) +
    geom_density(alpha = 0.5) +
    labs(x = 'Satisfaction Level', 
         y = 'Count',
         fill = 'Employee Status',
         title = 'Satisfaction Level across Employee Status')
g1.1
```

Clearly, the employees that left had low satisfaction levels. But it seems there were some employees with high satisfaction level among those that left.

Lets dig deeper.



<br><br><br><html>

Lets plot satisfation vs last evaluation

```{r}
g1.2 <- hra.data %>% 
    ggplot(mapping = aes(x = satisfaction_level, 
                         y = last_evaluation)) +
    geom_point(alpha = 0.3) +
    geom_abline(slope = 0, intercept = mean(hra.data$last_evaluation)) +
    geom_vline(xintercept = mean(hra.data$satisfaction_level)) +
    facet_wrap(~emp.status)
g1.2
```

There are 5 separate clusters correspoding to the 5 peaks in the previous graph. 

In the Left plot, there is group that had both high satisfaction and high evaluation, yet they still left.

Lets dig further.



<br><br><br><html>

Plotting satisfation vs no. of projects and Average monthly hours

```{r}
g1.3 <- hra.data %>%
    ggplot(mapping = aes(x = satisfaction_level,
                         y = average_montly_hours,
                         color = number_project)) +
    geom_point(alpha = 0.5) +
    geom_abline(slope = 0, intercept = mean(hra.data$average_montly_hours)) +
    geom_vline(xintercept = mean(hra.data$satisfaction_level)) +
    facet_wrap(~emp.status)
g1.3
```

Again, we get similar clusters. Fo the Employees Left plot:

Cluster 1: High Evaluation BUT too much work(High monthy hours + High no of projects) -> Low Satifaction -> Left  
Cluster 2: Low Evaluation AND too less work(Low monthy hours + Low no of projects) -> Below Average Satifaction -> Left  
Cluster 3: High Evaluation AND good amount of work(Above average monthy hours + Average no of projects) -> Above Average Satifaction -> Why Left?



Why did Cluster-3 employees leave?


<br><br><br><html>
###Employee Experience

Lets see distribution of Employee Status over Employee Experience.

```{r}
g2 <- hra.data %>%
    ggplot(mapping = aes(x = time_spend_company, fill = emp.status)) +
    geom_bar(position = 'dodge') +
    labs(x = 'Employee Experience (Years)', 
         y = 'Count',
         fill = 'Employee Status',
         title = 'Distribution of Employee Status over Employee Experience')
g2
```

Most of the employees that leave have spent 3 to 6 years at the company. 

The most problematic is the 4-5 years range. The overall ratio of Left to Retained is 1:3. but, for 4 years its roughly 1:2; while for 5 years the no. of employees that left are more than those retained.



<br><br><br><html>
###Work Accident

Lets see distribution of Employee Status over whether or not employee had some work accident.

```{r}
g3 <- hra.data %>%
    ggplot(mapping = aes(x = Work_accident, fill = emp.status)) +
    geom_bar(mapping = aes(y = ..count../sum(..count..)), 
             position = 'dodge') +
    labs(x = 'Work Accident', 
         y = 'Count',
         fill = 'Employee Status',
         title = 'Distribution of Employee Status over Work Accident')
g3
```

It does not look like Work Accident had much effect over employees leaving. Rather, we can say that employees who had a work accident are more likely to stay than leave.






